# 1. DRBD 概要

DRBD是一种基于软件的、无共享的、复制的存储解决方案，镜像主机之间的块设备（硬盘，分区，逻辑卷等）的内容。

DRBD镜像数据

* 实时。当应用程序修改设备上的数据时，复制会持续发生。
* 透明。应用程序不需要知道数据存储在多台主机上。
* 同步或异步。通过同步镜像，在所有（已连接）主机上执行写入之后，将通知应用程序的写入完成。通过异步镜像，当本地完成写入操作时，会将应用程序通知写入完成，这通常在传播到其他主机之前。

## 1.1 内核模块

DRBD的核心功能是通过Linux内核模块实现的。具体来说，DRBD构成虚拟块设备的驱动程序，因此DRBD位于系统I / O堆栈底部附近。正因为如此，DRBD非常灵活和通用，这使得它成为一种适合于为任何应用程序增加高可用性的复制解决方案。

根据定义，根据Linux内核架构的规定，DRBD与其上面的层不可知。因此，DRBD不可能奇迹般地将功能添加到这些不具有的上层。例如，DRBD无法自动检测文件系统损坏，或者为文件系统（如ext3或XFS）添加主动 - 主动集群功能。

图1.1。 DRBD在Linux I / O堆栈中的地位

![drbd-in-kernel](./images/drbd-in-kernel.png)

## 1.2 用户管理工具

DRBD附带一套与内核模块通信的管理工具，以配置和管理DRBD资源。从顶层到最底层都是：

*drbdmanage* 作为单独的项目提供，这是在多节点群集中编排DRBD资源的推荐方法。DRBD Manage使用一个DRBD 9资源来存储其群集范围的配置数据，并通过调用外部程序（如lvcreate和drbdadm），提供了一种快速简单的方式来执行最常用的管理任务。

有关详细信息，请参阅本文档中的DRBD管理条目。

*drbdadm* DRBD-utils程序套件的高级管理工具。从配置文件/etc/drbd.conf获取所有DRBD配置参数，并充当drbdsetup和drbdmeta的前端。drbdadm具有干运行模式，使用-d选项调用，显示drbdsetup和drbdmeta调用drbdadm将会发出而不实际调用这些命令。

*drbdsetup* 配置加载到内核中的DRBD模块。 drbdsetup的所有参数必须在命令行中传递。 drbdadm和drbdsetup之间的分离允许最大的灵活性。大多数用户很少需要直接使用drbdsetup，如果有的话。

*drbdmeta* 允许创建，转储，恢复和修改DRBD元数据结构。像drbdsetup一样，大多数用户很少需要直接使用drbdmeta。